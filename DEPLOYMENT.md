# üöÄ PayFlow Deployment Guide

Deploy **backend ‚Üí Render** and **frontend ‚Üí Firebase Hosting** in under 15 minutes.

---

## üìã Prerequisites

Make sure you have these installed:
```bash
npm install -g firebase-tools    # Firebase CLI
```

And accounts on:
- [render.com](https://render.com) (free account)
- [firebase.google.com](https://firebase.google.com) (free account)
- [github.com](https://github.com) (project must be pushed here)

---

## STEP 1 ‚Äî Push Project to GitHub

If not already done:
```bash
cd /Users/anuragdineshrokade/Documents/PayFlow
git init
git add .
git commit -m "Initial commit ‚Äî ready for deployment"
git remote add origin https://github.com/YOUR_USERNAME/payflow.git
git push -u origin main
```

---

## STEP 2 ‚Äî Deploy Backend to Render

### 2a. Create a Render account
Go to [render.com](https://render.com) ‚Üí Sign up with GitHub.

### 2b. Deploy using render.yaml (Blueprint)
1. In the Render dashboard, click **"New +"** ‚Üí **"Blueprint"**
2. Connect your GitHub repo (`payflow`)
3. Render will auto-detect `render.yaml` and create:
   - A **Web Service** (`payflow-api`)
   - A **PostgreSQL Database** (`payflow-db`)
4. Click **"Apply"** ‚Äî wait ~3-5 minutes for the build to finish.

### 2c. Get your Render backend URL
After deployment, go to your Web Service ‚Üí copy the URL at the top:
```
https://payflow-api.onrender.com
```
> ‚ö†Ô∏è Save this URL ‚Äî you need it for the frontend!

### 2d. Verify backend is live
Visit: `https://payflow-api.onrender.com/health`
You should see: `{"status": "ok"}`

Also check the Swagger docs: `https://payflow-api.onrender.com/docs`

---

## STEP 3 ‚Äî Set Up Firebase Project

### 3a. Create Firebase project
1. Go to [console.firebase.google.com](https://console.firebase.google.com)
2. Click **"Add Project"**
3. Name it `payflow` ‚Üí disable Google Analytics ‚Üí **Create Project**
4. Copy your **Project ID** (e.g. `payflow-a1b2c`)

### 3b. Update .firebaserc
Edit `.firebaserc` and replace `YOUR_FIREBASE_PROJECT_ID`:
```json
{
  "projects": {
    "default": "payflow-a1b2c"
  }
}
```

---

## STEP 4 ‚Äî Configure Frontend for Production

### 4a. Set the Render backend URL
Edit `frontend/.env.production` and replace the placeholder:
```env
VITE_API_URL=https://payflow-api.onrender.com
```
> ‚ö†Ô∏è No trailing slash!

### 4b. Build the frontend
```bash
cd frontend
npm install
npm run build
```
This creates `frontend/dist/` ‚Äî the production build.

---

## STEP 5 ‚Äî Deploy Frontend to Firebase

### 5a. Login to Firebase
```bash
firebase login
```

### 5b. Initialize Firebase (first time only)
```bash
cd /Users/anuragdineshrokade/Documents/PayFlow
firebase use --add   # select your project
```

### 5c. Deploy!
```bash
firebase deploy --only hosting
```

After deploy you'll see:
```
‚úî  Deploy complete!
Hosting URL: https://payflow-a1b2c.web.app
```

---

## STEP 6 ‚Äî Link Frontend URL Back to Render

Now go to **Render Dashboard** ‚Üí your `payflow-api` service ‚Üí **Environment** tab.

Update the `FRONTEND_URL` variable:
```
FRONTEND_URL = https://payflow-a1b2c.web.app
```

Click **Save Changes** ‚Äî Render will redeploy automatically. This locks CORS to your Firebase URL.

---

## ‚úÖ Final Checklist

| Check | URL |
|-------|-----|
| Backend health | `https://payflow-api.onrender.com/health` |
| Backend API docs | `https://payflow-api.onrender.com/docs` |
| Frontend live | `https://payflow-a1b2c.web.app` |
| Can register user | Try registering at the frontend |
| Can make payment | Try sending a test payment |
| Admin dashboard | Register with `role: admin`, login and check stats |

---

## üîÅ Re-deploying After Code Changes

**Backend (Render)** ‚Äî auto-deploys on every `git push` to `main`.

**Frontend (Firebase)** ‚Äî run manually:
```bash
cd frontend
npm run build
cd ..
firebase deploy --only hosting
```

---

## ‚ö†Ô∏è Important Notes

| Topic | Note |
|-------|-------|
| **Free tier cold starts** | Render free tier spins down after 15 min of inactivity. First request after idle takes ~30s to wake up. |
| **Free PostgreSQL** | Render free PostgreSQL expires after 90 days. Upgrade or export data before then. |
| **Secrets** | `SECRET_KEY` is auto-generated by Render. Never commit `.env`. |
| **CORS** | After step 6, only your Firebase URL can call the API. |

---

## üÜò Troubleshooting

**Problem**: Firebase deploy says "hosting site not found"
**Fix**: Run `firebase use --add` and select your project.

**Problem**: API calls fail with CORS error on Firebase
**Fix**: Make sure `FRONTEND_URL` in Render matches exactly (no trailing slash).

**Problem**: Backend logs "DATABASE_URL not set"
**Fix**: In Render ‚Üí Environment ‚Üí verify `DATABASE_URL` is linked from `payflow-db`.

**Problem**: Login fails on deployed frontend
**Fix**: Confirm `VITE_API_URL` in `frontend/.env.production` has no trailing slash, then rebuild and redeploy.
